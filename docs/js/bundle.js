!function e(t,s,o){function n(r,a){if(!s[r]){if(!t[r]){var c="function"==typeof require&&require;if(!a&&c)return c(r,!0);if(i)return i(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var d=s[r]={exports:{}};t[r][0].call(d.exports,(function(e){return n(t[r][1][e]||e)}),d,d.exports,e,t,s,o)}return s[r].exports}for(var i="function"==typeof require&&require,r=0;r<o.length;r++)n(o[r]);return n}({1:[function(e,t,s){const o=e("./userfunctions.js");t.exports={booksSection:{type:"li",classes:["book"],attributes:{itemtype:"http://schema.org/Book",itemscope:""},dataset:{number:null},innerHTMLcreator:function(e,t){return"\n <a class = 'book__cover'  data-href = ".concat(e.cover.large,">\n <img itemprop = 'image' alt = 'book cover'class='book__cover__image fadein' src=").concat(e.cover.small,">\n                                    </a>\n                                    <div class='bookInfo'>\n                                        <div class='bookInfo__titleContainer'>\n                                            <p class= 'bookInfo__title' itemprop ='name'>").concat(e.title,"</p>\n                                           \n                                            \n                                        </div>\n                                        <div class='book__details'>\n                                            <p itemprop ='author' class= \"book__details_author\"><span> ").concat(t.processedFirstName(e.author),"</span> ").concat(t.getSurname(e.author),"</p>\n <p itemprop ='datePublished'><span>Release Date:</span> ").concat(e.releaseDate,"</p>\n  <p itemprop = 'numberOfPages'><span>Pages:</span> ").concat(e.pages,"</p>\n <p itemprop ='discussionUrl'><span>Link:</span> <a href = ").concat(e.link,">shop</a></p>\n  </div>\n </div>\n    \n    \n  ")},extraFunction:o.name},noBooksModal:{type:"div",classes:["noBooksModal__content"],attributes:{id:"noBooksModal-content"},innerHTMLcreator:function(){return"<span id ='closeNoBooksScreen' class='noBooksModal__close'>&times;</span><div><span>Nie znaleziono przedmiotów </span><br><span>spełniających kryteria wyszukiwania</span></div>"}},modal:{type:"div",classes:["myModal__content"],attributes:{id:"myModal-content"},innerHTMLcreator:function(){const e=this.target.dataset.href;return"<span id ='close' class=\"myModal__close icon-circle-regular icon-times-solid \"> </span><img  class = 'myModal__image' src=".concat(e,"></img>")}}}},{"./userfunctions.js":4}],2:[function(e,t,s){const o=e("./userfunctions.js"),n=e("./config.js");var{showError:i}=e("./showError");class r{constructor(){this._events={}}on(e,t){return(this._events[e]||(this._events[e]=[])).push(t),this}emit(e,t){(this._events[e]||[]).slice().forEach(e=>e(t))}}class a{constructor(e,t){this.location=e,this.config=t,this.el=null}createNode(){return this.config.hasOwnProperty("type")&&(this.el=document.createElement(this.config.type)),this.config.hasOwnProperty("classes")&&this.config.classes.forEach(e=>this.el.classList.add(e)),this.setFromObject("attributes"),this.setFromObject("dataset"),this.el}setFromObject(e){if(this.config.hasOwnProperty(e))for(const t in this.config[e])this.config[e].hasOwnProperty(t)&&(this.el[e][t]=this.config[e][t])}removeNode(){for(;this.location.hasChildNodes();)this.location.removeChild(this.location.lastChild)}attachInnerHTML(e){e.innerHTML=this.config.innerHTMLcreator()}appendNode(){this.location.appendChild(this.el)}}class c extends a{create(){"none"===this.location.style.display&&(this.location.style.display="flex");const e=this.createNode();e.innerHTML=this.config.innerHTMLcreator(),this.appendNode(e)}clear(){this.removeNode(),"flex"===this.location.style.display&&(this.location.style.display="none")}}class l extends a{constructor(e,t,s){super(t,s),this.data=e,this.name=s.extraFunction}create(){this.data.length>0&&this.data.forEach((e,t)=>{this.config.dataset={number:t+1};const s=this.createNode();s.innerHTML=this.config.innerHTMLcreator(e,this.name),this.appendNode(s)})}clear(){return this.removeNode(),this}}class d{constructor(e,t){this.func=t,this.emptyQuery={filter:null,sort:null},Array.isArray(e)?(this.basicBooks=e,this.processedBooks=e,this.query=this.emptyQuery):(this.basicBooks=e.basicBooks,this.processedBooks=e.processedBooks,this.query=e.query)}clearQuery(){this.query=this.emptyQuery}updateQuery(e){this.query=e}filtrate(){const e=Number(this.query.filter);if(null===e)this.processedBooks=this.basicBooks;else{const t=function(t){return t.pages>e};this.processedBooks=this.basicBooks.filter(t)}return this}sort(){if(null===this.query.sort||0===this.processedBooks.length);else{const e={pages:function(e,t){return e.pages-t.pages},releaseDate:function(e,t){const s=function(e){return e.releaseDate.split("/")},o=function(e){return e[1].concat(e[0])};return Number(o(s(e)))-Number(o(s(t)))},author:(e,t)=>this.func.getSurname(e.author.toLowerCase())>this.func.getSurname(t.author.toLowerCase())};this.processedBooks.sort(e[this.query.sort])}}processContent(){this.filtrate().sort()}get data(){const e={};return e.basicBooks=this.basicBooks.slice(),e.processedBooks=this.processedBooks.slice(),e.query=Object.assign({},this.query),e}get processedItems(){return this.processedBooks.slice()}}class u extends r{constructor(e,t){super(),this.location=t,this.storageAvailable=Modernizr.sessionstorage,this.create(e)}saveToStorage(){this.storageAvailable&&(sessionStorage.setItem(this.location,JSON.stringify(this.Books.data)),this.saveToStorage=()=>{sessionStorage.setItem(this.location,JSON.stringify(this.Books.data))})}update(e){0===arguments.length?(this.Books.clearQuery(),this.saveToStorage(),this.emit("reset_filters")):JSON.stringify(e)===JSON.stringify(this.Books.query)||(this.Books.updateQuery(e),this.Books.processContent(),this.saveToStorage(),!this.Books.processedItems.length>0&&this.emit("no_books_found"),this.emit("updated",this.Books.data))}getData(){return this.Books.data}getProcessedItems(){return this.Books.processedItems}create(e){this.Books=new d(e,o.name),this.Books.processContent(),this.saveToStorage()}}class h extends r{constructor(e,t){super(),this.nodes=e,this.data=t.getProcessedItems(),this.BooksSection=new l(t.getProcessedItems(),this.nodes.booksContainer,n.booksSection),this.showBooks().mountHandlers(this.nodes),this.query=t.getData().query,this.setFilters()}setFilters(){this.nodes.pageQueryInput.value=this.query.filter;const e=document.getElementById(this.query.sort);e&&e.setAttribute("checked",!0)}resetFilters(){this.nodes.resetFilters()}getFilters(){const e={};e.filter=this.nodes.pageQueryInput.value?this.nodes.pageQueryInput.value:null;const t=this.nodes.radio.filter(e=>!!e.checked);return e.sort=t.length>0?t[0].value:null,e}mountHandlers(e){e.resetButton.addEventListener("click",()=>this.emit("reset_filters")),e.form.addEventListener("change",()=>{this.emit("changed_radios",this.getFilters())}),window.addEventListener("keyup",e=>{e.preventDefault(),this.emit("any_key_pressed",e)},!1),e.textInput.addEventListener("keydown",e=>{const t=e.keyCode;if((e.keyCode<48||e.keyCode>57&&e.keyCode<96||e.keyCode>105)&&13!==e.keyCode&&8!==e.keyCode)return e.preventDefault&&e.preventDefault(),!1;13===t&&(e.preventDefault(),this.emit("enter_pressed",this.getFilters()))}),this.mountModalTriggers()}showBooks(){return this.BooksSection.clear().create(),this.emit("booksLoaded"),this}showBookModal(e){const t=Object.assign({},n.modal);t.target=e,this.Modal=new c(this.nodes.myModal,t),this.Modal.create();document.getElementById("close").addEventListener("click",e=>this.emit("modal_close_clicked",this.Modal))}update(e){this.BooksSection.clear(),this.BooksSection=new l(e.processedBooks,this.nodes.booksContainer,n.booksSection),this.BooksSection.create(),this.nodes.pageQueryInput.value=e.query.filter,this.mountModalTriggers()}mountModalTriggers(){Array.from(document.getElementsByClassName("book__cover")).forEach(e=>{e.addEventListener("click",e=>this.emit("image_clicked",e.currentTarget))})}showNoBooksModal(){this.noBooksModal=new c(this.nodes.noBooksScreen,n.noBooksModal),this.noBooksModal.create(),document.getElementById("closeNoBooksScreen").addEventListener("click",e=>this.emit("no_books_modal_close_clicked",this.noBooksModal))}}class p{constructor(e,t){this.model=e,this.view=t,this.combineHandlers()}combineHandlers(){g.on("changed_radios",e=>m.update(e)),m.on("loaded",e=>g.update(e)),m.on("updated",e=>g.update(e)),g.on("any_key_pressed",e=>this.AltR(e)),m.on("reset_filters",e=>g.resetFilters(e)),g.on("reset_filters",e=>g.resetFilters(e)),g.on("enter_pressed",e=>m.update(e)),g.on("image_clicked",e=>g.showBookModal(e)),g.on("modal_close_clicked",e=>e.clear()),m.on("no_books_found",e=>g.showNoBooksModal(e)),g.on("no_books_modal_close_clicked",e=>e.clear())}AltR(e){e.stopPropagation(),e.preventDefault(),e||(e=window.event),e.isComposing||229===e.keyCode||82===e.which&&g.resetFilters()}}let m,g,f;window.onload=function(){!function(e,t){const s={booksContainer:document.getElementById("booksContainer"),pageQueryInput:document.getElementById("pageQueryInput"),radio:Array.from(document.getElementById("radioInputs").getElementsByTagName("input")),noBooksScreen:document.getElementById("noBooksModal"),noBooksScreenContent:document.getElementById("noBooksModal-content"),myModal:document.getElementById("myModal"),form:document.getElementById("radioInputs"),textInput:document.getElementById("textInput"),resetButton:document.getElementById("resetButton"),resetFilters(){this.pageQueryInput.value=null,this.radio.forEach(e=>{e.checked=!1})}},o=JSON.parse(sessionStorage.getItem(e));Modernizr.sessionstorage&&o?Modernizr.sessionstorage&&o&&(m=new u(o,e),g=new h(s,m),f=new p(m,g)):async function(e,t,s){try{const o=await fetch(e),n=await o.json();m=new u(n,t),g=new h(s,m),f=new p(m,g)}catch(e){i(e)}}(t,e,s)}("localBooks","https://api.jsonbin.io/b/5eaffc1a8284f36af7b53291/5")}},{"./config.js":1,"./showError":3,"./userfunctions.js":4}],3:[function(e,t,s){t.exports={showError:function(e){document.getElementById("error_description").textContent=e.message,document.getElementById("error_location").innerHTML=e.stack;const t=document.getElementById("errorModal");document.getElementById("closeErrorScreen").addEventListener("click",e=>{var s;(s=t)&&(s.style.display="none")}),t.style.display="flex"}}},{}],4:[function(e,t,s){t.exports={name:{getSurname:function(e){const t=function(e){return e.lastIndexOf(" ")};return-1===t(e)?e:e.slice(t(e)+1)},getFirstname:function(e){const t=function(e){return e.lastIndexOf(" ")};return-1===t(e)?e:e.slice(0,t(e))},processedFirstName:function(e){return"By "+this.getFirstname(e)}}}},{}]},{},[2]);