!function e(t,s,o){function n(i,a){if(!s[i]){if(!t[i]){var c="function"==typeof require&&require;if(!a&&c)return c(i,!0);if(r)return r(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var l=s[i]={exports:{}};t[i][0].call(l.exports,(function(e){return n(t[i][1][e]||e)}),l,l.exports,e,t,s,o)}return s[i].exports}for(var r="function"==typeof require&&require,i=0;i<o.length;i++)n(o[i]);return n}({1:[function(e,t,s){const o=e("./userfunctions.js");t.exports={booksSection:{type:"li",classes:["book"],attributes:{itemtype:"http://schema.org/Book",itemscope:""},dataset:{number:null},innerHTMLcreator:function(e,t){return"\n <a class = 'book__cover'  data-href = ".concat(e.cover.large,">\n <img itemprop = 'image' alt = 'book cover'class='book__cover__image fadein' src=").concat(e.cover.small,">\n                                    </a>\n                                    <div class='bookInfo'>\n                                        <div class='bookInfo__titleContainer'>\n                                            <p class= 'bookInfo__title' itemprop ='name'>").concat(e.title,"</p>\n                                           \n                                            \n                                        </div>\n                                        <div class='book__details'>\n                                            <p itemprop ='author' class= \"book__details_author\"><span> ").concat(t.processedFirstName(e.author),"</span> ").concat(t.getSurname(e.author),"</p>\n <p itemprop ='datePublished'><span>Release Date:</span> ").concat(e.releaseDate,"</p>\n  <p itemprop = 'numberOfPages'><span>Pages:</span> ").concat(e.pages,"</p>\n <p itemprop ='discussionUrl'><span>Link:</span> <a href = ").concat(e.link,">shop</a></p>\n  </div>\n </div>\n    \n    \n  ")},extraFunction:o.name},noBooksModal:{type:"div",classes:["noBooksModal__content"],attributes:{id:"noBooksModal-content"},innerHTMLcreator:function(){return"<span id ='closeNoBooksScreen' class='noBooksModal__close'>&times;</span><div><span>Nie znaleziono przedmiotów </span><br><span>spełniających kryteria wyszukiwania</span></div>"}},modal:{type:"div",classes:["myModal__content"],attributes:{id:"myModal-content"},innerHTMLcreator:function(){const e=this.target.dataset.href;return"<span id ='close' class=\"myModal__close icon-circle-regular icon-times-solid \"> </span><img  class = 'myModal__image' src=".concat(e,"></img>")}}}},{"./userfunctions.js":4}],2:[function(e,t,s){const o=e("./userfunctions.js"),n=e("./config.js");var{showError:r}=e("./showError");class i{constructor(){this._events={}}on(e,t){return(this._events[e]||(this._events[e]=[])).push(t),this}emit(e,t){(this._events[e]||[]).slice().forEach(e=>e(t))}}class a extends class{constructor(e,t){this.location=e,this.config=t,this.el=null}createNode(){return this.config.hasOwnProperty("type")&&(this.el=document.createElement(this.config.type)),this.config.hasOwnProperty("classes")&&this.config.classes.forEach(e=>this.el.classList.add(e)),this.setFromObject("attributes"),this.setFromObject("dataset"),this.el}setFromObject(e){if(this.config.hasOwnProperty(e))for(const t in this.config[e])this.config[e].hasOwnProperty(t)&&(this.el[e][t]=this.config[e][t])}removeNode(){for(;this.location.hasChildNodes();)this.location.removeChild(this.location.lastChild)}attachInnerHTML(e){e.innerHTML=this.config.innerHTMLcreator()}appendNode(){this.location.appendChild(this.el)}}{constructor(e,t,s){super(t,s),this.data=e,this.name=s.extraFunction}create(){this.data.length>0&&this.data.forEach((e,t)=>{this.config.dataset={number:t+1};const s=this.createNode();s.innerHTML=this.config.innerHTMLcreator(e,this.name),this.appendNode(s)})}clear(){return this.removeNode(),this}}class c{constructor(e,t){this.func=t,this.emptyQuery={filter:null,sort:null},Array.isArray(e)?(this.basicBooks=e,this.processedBooks=e,this.query=this.emptyQuery):(this.basicBooks=e.basicBooks,this.processedBooks=e.processedBooks,this.query=e.query)}clearQuery(){this.query=this.emptyQuery}updateQuery(e){this.query=e}filtrate(){const e=Number(this.query.filter);if(null===e)this.processedBooks=this.basicBooks;else{const t=function(t){return t.pages>e};this.processedBooks=this.basicBooks.filter(t)}return this}sort(){if(null===this.query.sort||0===this.processedBooks.length);else{const e={pages:function(e,t){return e.pages-t.pages},releaseDate:function(e,t){const s=function(e){return e.releaseDate.split("/")},o=function(e){return e[1].concat(e[0])};return Number(o(s(e)))-Number(o(s(t)))},author:(e,t)=>this.func.getSurname(e.author.toLowerCase())>this.func.getSurname(t.author.toLowerCase())};this.processedBooks.sort(e[this.query.sort])}}processContent(){this.filtrate().sort()}get data(){const e={};return e.basicBooks=this.basicBooks.slice(),e.processedBooks=this.processedBooks.slice(),e.query=Object.assign({},this.query),e}get processedItems(){return this.processedBooks.slice()}}class d extends i{constructor(e,t){super(),this.location=t,this.storageAvailable=Modernizr.sessionstorage,this.create(e)}saveToStorage(){this.storageAvailable&&(sessionStorage.setItem(this.location,JSON.stringify(this.Books.data)),this.saveToStorage=()=>{sessionStorage.setItem(this.location,JSON.stringify(this.Books.data))})}update(e){0===arguments.length?(this.Books.clearQuery(),this.saveToStorage(),this.emit("reset_filters")):JSON.stringify(e)===JSON.stringify(this.Books.query)||(this.Books.updateQuery(e),this.Books.processContent(),this.saveToStorage(),!this.Books.processedItems.length>0&&this.emit("no_books_found"),this.emit("updated",this.Books.data))}getData(){return this.Books.data}getProcessedItems(){return this.Books.processedItems}create(e){this.Books=new c(e,o.name),this.Books.processContent(),this.saveToStorage()}}class l extends i{constructor(e,t){super(),this.nodes=e,this.data=t.getProcessedItems(),this.BooksSection=new a(t.getProcessedItems(),this.nodes.booksContainer,n.booksSection),this.showBooks().mountHandlers(this.nodes),this.query=t.getData().query,this.setFilters()}setFilters(){this.nodes.pageQueryInput.value=this.query.filter;const e=document.getElementById(this.query.sort);e&&e.setAttribute("checked",!0)}resetFilters(){this.nodes.resetFilters()}getFilters(){const e={};e.filter=this.nodes.pageQueryInput.value?this.nodes.pageQueryInput.value:null;const t=this.nodes.radio.filter(e=>!!e.checked);return e.sort=t.length>0?t[0].value:null,e}mountHandlers(e){e.resetButton.addEventListener("click",()=>this.emit("reset_filters")),e.form.addEventListener("change",()=>{this.emit("changed_radios",this.getFilters())}),window.addEventListener("keyup",e=>{e.preventDefault(),this.emit("any_key_pressed",e)},!1),e.textInput.addEventListener("keydown",e=>{const t=e.keyCode;if((e.keyCode<48||e.keyCode>57&&e.keyCode<96||e.keyCode>105)&&13!==e.keyCode&&8!==e.keyCode)return e.preventDefault&&e.preventDefault(),!1;13===t&&(e.preventDefault(),this.emit("enter_pressed",this.getFilters()))}),this.mountModalTriggers()}showBooks(){return this.BooksSection.clear().create(),this.emit("booksLoaded"),this}showBookModal(e){const t=document.getElementById("myModal");document.getElementById("book_modal_image").src=e.dataset.href,t.style.display="flex",document.getElementById("close").addEventListener("click",e=>this.emit("book_modal_close_clicked",t))}hideModal(e){e.style.display="none"}update(e){this.BooksSection.clear(),this.BooksSection=new a(e.processedBooks,this.nodes.booksContainer,n.booksSection),this.BooksSection.create(),this.nodes.pageQueryInput.value=e.query.filter,this.mountModalTriggers()}mountModalTriggers(){Array.from(document.getElementsByClassName("book__cover")).forEach(e=>{e.addEventListener("click",e=>this.emit("image_clicked",e.currentTarget))})}showNoBooksModal(){document.getElementById("error_description").textContent="Nie znaleziono książek spełniających kryteria wyszukiwania";const e=document.getElementById("errorModal");document.getElementById("closeErrorScreen").addEventListener("click",t=>this.emit("error_modal_close_clicked",e)),e.style.display="flex"}}class u{constructor(e,t){this.model=e,this.view=t,this.combineHandlers()}combineHandlers(){p.on("changed_radios",e=>h.update(e)),h.on("loaded",e=>p.update(e)),h.on("updated",e=>p.update(e)),p.on("any_key_pressed",e=>this.AltR(e)),h.on("reset_filters",e=>p.resetFilters(e)),p.on("reset_filters",e=>p.resetFilters(e)),p.on("enter_pressed",e=>h.update(e)),p.on("image_clicked",e=>p.showBookModal(e)),p.on("modal_close_clicked",e=>e.clear()),h.on("no_books_found",e=>p.showNoBooksModal(e)),p.on("no_books_modal_close_clicked",e=>e.clear()),p.on("error_modal_close_clicked",e=>p.hideModal(e)),p.on("book_modal_close_clicked",e=>p.hideModal(e))}AltR(e){e.stopPropagation(),e.preventDefault(),e||(e=window.event),e.isComposing||229===e.keyCode||82===e.which&&p.resetFilters()}}let h,p,m;function g(e,t,s){if(e&&t&&s)try{h=new d(e,t),p=new l(s,h),m=new u(h,p)}catch(e){r(e)}}window.onload=function(){!function(e,t){const s={booksContainer:document.getElementById("booksContainer"),pageQueryInput:document.getElementById("pageQueryInput"),radio:Array.from(document.getElementById("radioInputs").getElementsByTagName("input")),noBooksScreen:document.getElementById("noBooksModal"),noBooksScreenContent:document.getElementById("noBooksModal-content"),myModal:document.getElementById("myModal"),form:document.getElementById("radioInputs"),textInput:document.getElementById("textInput"),resetButton:document.getElementById("resetButton"),resetFilters(){this.pageQueryInput.value=null,this.radio.forEach(e=>{e.checked=!1})}},o=JSON.parse(sessionStorage.getItem(e));Modernizr.sessionstorage&&o?Modernizr.sessionstorage&&o&&g(o,e,s):function(e,t,s){var o=new Worker("./js/fetchworker.js");o.onmessage=e=>{const o=e.data;o.message?r({message:"Nie udało się pobrać danych ze źródła",stack:"fetchworker.js"}):g(o,t,s)},o.postMessage(e)}(t,e,s)}("localBooks","https://api.jsonbin.io/b/5eaffc1a8284f36af7b53291/5")}},{"./config.js":1,"./showError":3,"./userfunctions.js":4}],3:[function(e,t,s){t.exports={showError:function(e){document.getElementById("error_description").textContent=e.message,document.getElementById("error_location").innerHTML=e.stack;const t=document.getElementById("errorModal");document.getElementById("closeErrorScreen").addEventListener("click",e=>{var s;(s=t)&&(s.style.display="none")}),t.style.display="flex"}}},{}],4:[function(e,t,s){t.exports={name:{getSurname:function(e){const t=function(e){return e.lastIndexOf(" ")};return-1===t(e)?e:e.slice(t(e)+1)},getFirstname:function(e){const t=function(e){return e.lastIndexOf(" ")};return-1===t(e)?e:e.slice(0,t(e))},processedFirstName:function(e){return"By "+this.getFirstname(e)}}}},{}]},{},[2]);